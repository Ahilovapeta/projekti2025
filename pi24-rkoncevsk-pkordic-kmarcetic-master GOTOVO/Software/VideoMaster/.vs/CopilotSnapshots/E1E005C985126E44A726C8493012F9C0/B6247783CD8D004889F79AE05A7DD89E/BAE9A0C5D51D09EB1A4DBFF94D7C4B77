using System;
using System.Linq;
using System.Windows.Forms;

namespace VideoMaster
{
    public partial class formPreporukaFilmova : Form
    {
        private PI2324_02_DBEntities DB_Entities;
        private Korisnik OdabraniKorisnik;

        public formPreporukaFilmova(Korisnik korisnik)
        {
            InitializeComponent();
            DB_Entities = new PI2324_02_DBEntities();
            OdabraniKorisnik = korisnik;
            UcitajPreporuke();
        }

        private void UcitajPreporuke()
        {
            // Pronađi najzastupljeniji žanr u povijesti gledanja korisnika
            var najzanrId = DB_Entities.Gleda
                .Where(g => g.ID_Korisnik == OdabraniKorisnik.ID_Korisnik && g.Film != null && g.Film.Zanr != null)
                .GroupBy(g => g.Film.ID_Zanr)
                .OrderByDescending(gr => gr.Count())
                .Select(gr => gr.Key)
                .FirstOrDefault();

            if (najzanrId != 0)
            {
                // Dohvati sve filmove tog žanra
                var preporuceniFilmovi = DB_Entities.Film
                    .Where(f => f.ID_Zanr == najzanrId)
                    .Select(f => new { f.Naziv, f.Datum_izdavanja })
                    .ToList();
                dgvPreporuke.DataSource = preporuceniFilmovi;
            }
            else
            {
                dgvPreporuke.DataSource = null;
                MessageBox.Show("Nema dovoljno podataka za preporuku.");
            }
        }

        private void btnNatrag_Click(object sender, EventArgs e)
        {

        }
    }
}
