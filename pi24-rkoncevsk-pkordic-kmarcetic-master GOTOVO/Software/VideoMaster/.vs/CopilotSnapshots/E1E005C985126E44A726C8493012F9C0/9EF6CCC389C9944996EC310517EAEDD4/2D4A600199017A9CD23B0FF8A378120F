using System;
using System.Linq;
using System.Windows.Forms;
using System.Collections.Generic;

namespace VideoMaster
{
    public partial class formPreporukaFilmova : Form
    {
        private PI2324_02_DBEntities DB_Entities;
        private Korisnik OdabraniKorisnik;

        public formPreporukaFilmova(Korisnik korisnik)
        {
            InitializeComponent();
            DB_Entities = new PI2324_02_DBEntities();
            OdabraniKorisnik = korisnik;
            UcitajPreporuke();
        }

        private void UcitajPreporuke()
        {
            // Pronađi najzastupljeniji žanr u povijesti gledanja korisnika bez LINQ-a
            Dictionary<int, int> brojacZanrova = new Dictionary<int, int>();
            foreach (var gleda in DB_Entities.Gleda)
            {
                if (gleda.ID_Korisnik == OdabraniKorisnik.ID_Korisnik && gleda.Film != null && gleda.Film.Zanr != null)
                {
                    int idZanr = gleda.Film.ID_Zanr;
                    if (brojacZanrova.ContainsKey(idZanr))
                    {
                        brojacZanrova[idZanr]++;
                    }
                    else
                    {
                        brojacZanrova[idZanr] = 1;
                    }
                }
            }

            // Pronađi žanr s najviše gledanja
            int najzanrId = 0;
            int maxBroj = 0;
            foreach (var par in brojacZanrova)
            {
                if (par.Value > maxBroj)
                {
                    maxBroj = par.Value;
                    najzanrId = par.Key;
                }
            }

            if (najzanrId != 0)
            {
                // Dohvati sve filmove tog žanra bez LINQ-a
                List<object> preporuceniFilmovi = new List<object>();
                foreach (var film in DB_Entities.Film)
                {
                    if (film.ID_Zanr == najzanrId)
                    {
                        preporuceniFilmovi.Add(new { film.Naziv, film.Datum_izdavanja });
                    }
                }
                dgvPreporuke.DataSource = preporuceniFilmovi;
            }
            else
            {
                dgvPreporuke.DataSource = null;
                MessageBox.Show("Nema dovoljno podataka za preporuku.");
            }
        }

        private void btnNatrag_Click(object sender, EventArgs e)
        {

        }
    }
}
